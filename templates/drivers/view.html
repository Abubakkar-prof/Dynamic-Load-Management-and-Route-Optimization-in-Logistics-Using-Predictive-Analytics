{% extends "base.html" %}

{% block title %}Operator Profile - {{ driver.user.full_name or driver.user.username }} - Logistics AI{% endblock %}

{% block content %}
<div class="section-header">
    <div>
        <div class="x-small text-body opacity-50 fw-bold text-uppercase mb-1" style="letter-spacing: 1px;">Personnel
            Registry</div>
        <h2 class="fw-bold text-heading mb-1" style="letter-spacing: -1px;">{{ driver.user.full_name or
            driver.user.username }} Profile</h2>
        <p class="text-body mb-0 small">Operational credentialing and performance telemetry for fleet personnel.</p>
    </div>
    <div class="d-flex gap-3">
        <a href="{{ url_for('drivers.list_drivers') }}"
            class="btn btn-secondary py-2 px-4 shadow-sm border-white border-opacity-10">
            <i class="fas fa-arrow-left me-2"></i>Personnel Index
        </a>
    </div>
</div>

<div class="row g-4">
    <div class="col-lg-8">
        <!-- Personnel Core -->
        <div class="card mb-4 overflow-hidden p-0">
            <div
                class="px-4 py-3 border-bottom border-white border-opacity-5 bg-dark bg-opacity-25 d-flex justify-content-between align-items-center">
                <h6 class="fw-bold mb-0 text-heading small"><i class="fas fa-user-shield me-2 text-primary"></i>Operator
                    Core</h6>
                {% set status_val = driver.status.value if driver.status.value is defined else driver.status|string %}
                {% if status_val == 'Available' %}
                <span
                    class="badge bg-success bg-opacity-10 text-success border-0 px-3 py-1 rounded-pill x-small fw-bold">READY</span>
                {% elif status_val == 'On Duty' %}
                <span
                    class="badge bg-primary bg-opacity-10 text-primary border-0 px-3 py-1 rounded-pill x-small fw-bold">ACTIVE
                    DUTY</span>
                {% else %}
                <span
                    class="badge bg-secondary bg-opacity-10 text-secondary border-0 px-3 py-1 rounded-pill x-small fw-bold">{{
                    status_val|upper }}</span>
                {% endif %}
            </div>
            <div class="p-4">
                <div class="row g-4">
                    <div class="col-md-6">
                        <div class="x-small text-body opacity-50 fw-bold text-uppercase mb-1">Full Legal Name</div>
                        <div class="text-heading fw-bold">{{ driver.user.full_name or 'N/A' }}</div>
                    </div>
                    <div class="col-md-6">
                        <div class="x-small text-body opacity-50 fw-bold text-uppercase mb-1">Electronic Registry</div>
                        <div class="text-heading fw-bold text-primary">{{ driver.user.email or 'N/A' }}</div>
                    </div>
                    <div class="col-md-6">
                        <div class="x-small text-body opacity-50 fw-bold text-uppercase mb-1">Personnel Comm-Link</div>
                        <div class="text-heading fw-bold">{{ driver.user.phone or 'N/A' }}</div>
                    </div>
                    <div class="col-md-6">
                        <div class="x-small text-body opacity-50 fw-bold text-uppercase mb-1">Certification Code</div>
                        <div class="text-heading fw-bold text-info">{{ driver.license_number }}</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Missions -->
        <div class="card p-0 overflow-hidden">
            <div class="px-4 py-3 border-bottom border-white border-opacity-5 bg-dark bg-opacity-25">
                <h6 class="fw-bold mb-0 text-heading small"><i
                        class="fas fa-clipboard-list me-2 text-warning"></i>Recent Mission Logs</h6>
            </div>
            <div class="p-0">
                {% if routes %}
                <div class="table-responsive">
                    <table class="table mb-0">
                        <thead>
                            <tr>
                                <th>Mission ID</th>
                                <th>Timestamp</th>
                                <th>Resource ID</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for route in routes %}
                            <tr>
                                <td class="fw-bold text-heading">{{ route.route_id }}</td>
                                <td class="small">{{ route.date.strftime('%Y-%m-%d') if route.date else 'N/A' }}</td>
                                <td>{{ route.vehicle.vehicle_id if route.vehicle else 'UNASSIGNED' }}</td>
                                <td><span
                                        class="badge bg-primary bg-opacity-10 text-primary x-small fw-bold">LOGGED</span>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-5 opacity-50">
                    <i class="fas fa-user-clock fa-3x mb-3 text-body opacity-25"></i>
                    <p class="small mb-0">No historical mission logs found in the personnel record.</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="col-lg-4">
        <!-- Performance Telemetry -->
        <div class="card mb-4 text-center py-5">
            <div class="mx-auto bg-primary bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center mb-4 border border-primary border-opacity-25"
                style="width: 100px; height: 100px;">
                <div>
                    <div class="h2 fw-bold text-heading mb-0">{{ driver.rating }}</div>
                    <div class="x-small text-body opacity-50 fw-bold">RATING</div>
                </div>
            </div>
            <h5 class="text-heading fw-bold mb-1">Performance Tier</h5>
            <div class="d-flex justify-content-center gap-1 mb-4">
                {% for i in range(5) %}
                <i
                    class="fas fa-star {% if i < driver.rating|int %}text-warning{% else %}text-body opacity-25{% endif %}"></i>
                {% endfor %}
            </div>
            <hr class="mx-4 opacity-5">
            <div class="px-4 mt-4">
                <div class="row g-2">
                    <div class="col-6 border-end border-white border-opacity-5">
                        <div class="h4 fw-bold text-heading mb-0">{{ driver.total_deliveries }}</div>
                        <div class="x-small text-body opacity-50">MISSIONS</div>
                    </div>
                    <div class="col-6">
                        <div class="h4 fw-bold text-heading mb-1">98%</div>
                        <div class="x-small text-body opacity-50">SLA RATE</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Assignment Node -->
        <div class="card">
            <h6 class="fw-bold text-heading small mb-4">Hardware Assignment</h6>
            {% if driver.vehicle %}
            <div class="bg-dark bg-opacity-25 rounded-4 p-3 border border-white border-opacity-5 mb-4">
                <div class="d-flex align-items-center">
                    <div class="bg-primary bg-opacity-10 p-2 rounded-3 me-3">
                        <i class="fas fa-truck text-primary"></i>
                    </div>
                    <div>
                        <div class="fw-bold text-heading small">{{ driver.vehicle.vehicle_id }}</div>
                        <div class="x-small text-body opacity-50">{{ driver.vehicle.make }} {{ driver.vehicle.model }}
                        </div>
                    </div>
                </div>
            </div>
            <a href="{{ url_for('vehicles.view_vehicle', vehicle_id=driver.vehicle.id) }}"
                class="btn btn-secondary w-100 py-3 small fw-bold">
                Inspect Asset Connectivity
            </a>
            {% else %}
            <div class="text-center py-4 opacity-50 border border-dashed rounded-4 border-white border-opacity-10">
                <div class="x-small fw-bold">NO HARDWARE NODE ASSIGNED</div>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}